# 4주차 - 헤더, 캐시

## 301, 303 요청을 했을 때 왜 htttpstat.us 페이지의 메인으로 redirect될까?

### redirect란?

사용자가 처음 요청한 URL이 아닌, 다른 URL로 보내는 것을 말한다. URL의 모양을 사용자 지정하고 링크가 끊어지지 않도록 하며 주소를 변경하지 않고 앱이나 사이트의 호스팅 위치를 이동하고 요청된 URL을 웹 앱에 필요한 형식으로 변경한다.

### 301 Mover Permanently

* 301 리다이렉션은 웹 주소의 대상 주소를 지속적으로 변경하려는 것을 의미한다.

* 요청된 리소스가 Location헤더가 지정한 URL로 이동되었음을 나타낸다. 

* 해당 URL로 리다이렉트 되면, 요청 메서드가 GET으로 변하고 본문이 제거될 수 있다.


**301 상태코드 흐름 예시**

![301 redirect](https://github.com/Juyoung03/2024-1-Web-Study/assets/161465764/9737aa17-5e00-45df-8d4c-38946f50fc96)

1. 클라이언트는 '/event'라는 URL을 웹 서버에 전송하여 이벤트 페이지에 대한 GET요청한다.

2. '/event'는 더 이상 사용하지 않는 URL이며, 현재는 '/new-event'를 사용하고 있어 서버에서 301 redirect 상태 코드와 함께 헤더의 Location 필드에 새로운 URL인 '/new-event'를 담아 응답메시지를 전송한다.

3. 응답 메시지를 전달받은 클라이언트는 301 상태 코드와 Location 필드의 URL을 참고하여, 새로운 URL로 리다이렉션하라는 것을 인지한다.

4. 클라이언트는 '/new-event'라는 URL을 웹서버에 전송하여 이번트 페이지에 대한 GET요청한다.

5. 서버는 200 OK와 함께 이벤트 페이지의 html을 전송해준다.


### 303 See Other

* 다른 URL에서 리소스를 찾는다.

* 302 Found와 그능은 동일하게 일시 리다이렉트 시 요청 메서드가 GET로 고정되고 본문을 제거한다.

* 302 Found와 다르게 요청 메서드의 변경과 본문 제거 행위를 무조건적으로 보장한다.

* 클라이언트가 요청한 리소스를 다른 URI에서 GET요청을 통해 얻어야 할 때, 서버가 클라이언트로 보내는 응답으로 이용된다.

* 보통 PUT 또는 POST의 결과로서 요청에 대한 응답으로 클라이언트에게 리소스의 위치를 알려주는 용도로 쓰인다.

## 401 요청을 했을 때, 네트워크 탭의 상태를 보고 어떻게 인증해야 하는지 www-Authenticate 헤더를 기반으로 설명하기

### www-Authenticate 헤더

HTTP의 www-Authenticate 응답 헤더는 특정 리소스에 대한 액세스 권한을 얻는데 사용할 수 있는 HTTP 인증 방법을 정의한다.

401 Unauthorized 응답과 함께 사용한다.

서버는 사용자에게 사용자의 이름과 비밀번호를 제공하라는 의미로 401 상태 정보와 함께 요청을 반려한다. 서버에는 각각 다른 비밀번호가 있는 영역들이 있으므로, 서버는 www-Authenticate 헤더에 해당 영역을 설명해 놓는다.

### www-Authenticate 헤더 기반 인증 방법

처음에 인증 없이 서버에 접근하면 401 코드와 함께 헤더에 

    www-Authenticate : {type} realm="인증에 대한 알림 메시지" 
형태로 응답을 준다.

인증을 위해서는 내가 나라는 것을 증명해야 한다. 가장 쉬운 증명 방법으로는 **username**과 **password**를 이용한 것이 있다.

클라이언트는 username과 password를 헤더에 보내서 인증할 수 있다. 하지만 정보를 그래도 보내면 누구나 개인정보를 가져갈 수 있으므로 암호화가 필요하다.

credentials 는 기본적으로 Base64 인코딩을 따른다. username이 john이고 password가 doe인 경우

Base64Encoded("john:doe")로 표현하고 그 값은

    Authorization: Basic am9objpkb2U=
이 된다.

이 형태를 Request 를 보낼 때, 헤더에 키와 값을 붙여서 보내면 서버에서 해당 헤더의 값을 읽어 기본 인증을 확인 한 후에 **username:password**에 맞는 값을 매칭하여 인증하는 형태이다.

    GET / home
    Authorization: Basic am9objpkb2U=

    200 Ok

![www-Authenticate](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FC46Sk%2FbtscJrZO9ap%2FPviPiZSj1MUtcFKYEXLvsk%2Fimg.png)

---

### Google에 "Hello"를 입력하여 결과물을 보고, 네트워크 요청 탭에서 캐시 관련 정보가 어디에 저장되어 있는지 분석하기

#### 캐시란? 

자주 쓰이는 문서의 사본을 저장하는 HTTP 장치

#### 캐시의 주요 역할

* 서버로부터 받은 사본 저장

* 해당 사본에 대한 "신선도 검사"

* 클라이언트가 요청한 문서를 제공

    - 캐시에서 신선도 검사 했을 때

    통과가 되면(서버로부터 304 Not Modified 받을 때) 유효기간 관련 헤더를 갱신하고, 해당 사본을 200 OK 메시지와 함께 클라이언트에게 보낸다.

    통과가 안되면 서버에서 200 OK와 함께 본문이 캐시로 온다. 이것을 캐시에 다시 저장하고, 클라이언트로 보낸다.

    - 클라이언트 입장에서는 요청한 문서가 캐시에서 온 것인지, 서버에서 온 것인지 직접적으론 알기 어렵다.


<캐시가 없는 경우>

    클라이언트가 웹 브라우저에서 매번 똑같은 100MB 짜리 영상을 웹 서버로 받아온다. 매번 동영상이 다운로드 완료까지 긴 대기시간이 생기며 서버 응답의 네트워크 트래픽 및 비용이 발생한다.

<캐시가 있는 경우>

    첫번째 요청에 100MB 짜리 영상을 캐시에 임의 저장한다. 클라이언트가 두번째 요청을 한다면 캐시에서 영상을 반환한다. 다운로드 없이 바로 시청 가능하고 서버에 요청하지 않아 네트워크 트래픽 및 비용이 감소한다.

#### 캐시는 어디에 있는가?

캐시는 웹 브라우저, 웹 서버(프록시 서버, CDN)에 위치한다.

* CPU 캐시 : CPU 연산을 위해 메모리에서 값을 가져와 사용 후 폐기

* HTTP 캐시 : 웹 요청에 따른 결과를 임시 저장 후 폐기

* 서버 캐시 :  LRU-Cache 로컬 캐시, 클로벌 캐시

**HTTP 캐시 종류**

1. Private : 대상이 특정 한 명

단일 사용자만 전용으로 사용한다. 캐시가 웹 브라우저 안에 있어 유저 한명만을 위한 것이다. 

2. Shared : 대상이 불특정 다수

불특정 다수가 사용하며 캐시가 웹 브라우저와 웹 서버 사이에 있어 모든 웹 브라우저 유저 다수를 위한 것이다.

#### 캐시 저장 여부

* no-store : 캐시를 사용하지 않는다

* no-cache : 캐시 저장은 한다 하지만 매번 재검증 후 시용

#### 캐시 저장 장소

* public : Private + Shared 모두에 저장(브라우저 캐시 + 프록시 캐시)

![public](https://github.com/Juyoung03/2024-1-Web-Study/assets/161465764/b94700e3-e626-4b38-af83-90a4194fab58)

* private : Private에만 저장(브라우저 캐시)

![private](https://github.com/Juyoung03/2024-1-Web-Study/assets/161465764/156c3728-9c1d-4d57-aff5-d3cd104b5973)

#### 캐시 재검증 주기

* max-age : 유효시간으로 변환되기 때문에 기존 유효시간이 있어도 덮어씀

매번 재검증 : max-age=0, no-cache

#### 재검증 강제

* must-revalidate : max-age에 도달하였을 때 꼭 재검증이 왼료된 뒤 사용하도록 가제

![재검증](https://github.com/Juyoung03/2024-1-Web-Study/assets/161465764/af11c1bd-4010-45ed-9f2d-5b4bccaa78e3)